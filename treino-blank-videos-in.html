<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles/reset.css">
    <link rel="stylesheet" href="/styles/style-videos-in.css">
    <title>MusclePlan - BLANK [videos]</title>
</head>
<body>
    <header class="cabecalho">
        <div class="export-buttons">
            <button class="export-whatsapp" onclick="exportToWhatsApp()">Exp. WhatsApp</button>
            <button class="export-excel" onclick="exportToExcel()">Exp. Excel</button>
            <button class="export-log" onclick="saveData()">Exp. Log File</button>
        </div>

    </header>
    
    <main class="main__treino-blank">

        <!-- <h1 class="titulo__semana-dia">SEMANA <textarea class="titulo__semana">1</textarea> · DIA<textarea class="titulo__dia">1</textarea></h1> -->

        <ul class="lista__titulo-do-treino">
            <li class="lista__titulo-do-treino__item">
                <div class="lista__titulo-do-treino__item-div">
                    <textarea class="titulo-do-treino" placeholder="NOME DO TREINO" maxlength="30" oninput="limitLines(this, 1); updateCounter(this)"></textarea>
                    <span class="contador"></span>
                </div>
                <a href="index.html" class="back-to-index"><img src="/img/logo.png" class="logo-treino-blank"></a>
            </li>
        </ul>

        <textarea class="treino__obs" placeholder="Observações gerais sobre o treino" maxlength="130" oninput="limitLines(this, 3); updateCounter(this)"></textarea>
        <span class="contador"></span>

        <section class="exercicio-n" id="exercicio-1">

            <ul class="lista__nome-do-exercicio">
                <li class="lista__nome-do-exercicio__item">
                    <p class="lista__nome-do-exercicio__numero">1</p>
                    <textarea class="exercicio__nome" placeholder="Nome do exercício" maxlength="32" oninput="limitLines(this, 1)"></textarea>
                    <button class="youtube-button" onclick="searchYouTubeDynamic('exercicio-1')">></button>
                </li>     
            </ul>

            <div class="video-container" id="video-container-1"></div> <!-- Espaço para o vídeo -->

            <textarea class="exercicio__obs" placeholder="Observações sobre o exercício" maxlength="150"  oninput="limitLines(this, 4); updateCounter(this)"></textarea>
            <span class="contador"></span>

            <ul class="lista__primeira-linha">
                <li>
                    <p>Set</p>
                </li>
                <li>
                    <select class="select-repetitions">
                        <option class="option" value="reps range">Faixa de Repetições</option>
                        <option value="reps">Repetições</option>
                        <option value="reps max">Repetições Máximas</option>
                        <option value="amrap">AMRAP</option>
                        <option value="time">Tempo</option>
                        <option value="time range">Faixa de Tempo</option>
                    </select>             
                </li>

                <li>
                    <select class="select-kg">
                        <option value="kg">KG</option>
                        <option value="lb">LB</option>
                    </select>             
                </li>

                <li>
                    <select class="select-rpe">
                        <option value="rpe range">Faixa de Int. (PSE)</option>
                        <option value="rpe">Int. (PSE)</option>
                        <option value="% of 1rm range">Faixa de % de 1RM</option>
                        <option value="% of 1rm">% de 1RM</option>
                    </select>             
                </li>

            </ul>


            <ul class="lista__aquecimento">
                <li class="lista__aquecimento__item">
                    <p class="lista__aquecimento__w">a</p>
                </li>
                <li class="lista__aquecimento__item">
                    <input class="lista__aquecimento__input input-reps1" type="number">
                    <p>-</p>
                    <input class="lista__aquecimento__input input-reps2" type="number">
                </li>
                <li class="lista__aquecimento__item">
                    <input class="lista__aquecimento__input input-kg" type="number">
                </li>
                <li class="lista__aquecimento__item">
                </li>
                <li class="lista__aquecimento__item">
                    <!-- <button class="remove-list-button" onclick="removeList('lista__aquecimento')"><img class="trash-img" src="img/trash-branca.png"></button> -->
                </li>
            </ul>


            <ul id="myList1" class="lista__segunda-linha">
                <li class="lista__segunda-linha__item">
                    <p>1</p>
                </li>
                <li class="lista__segunda-linha__item">
                    <input class="lista__segunda-linha__input input-reps1" type="number">
                    <p>-</p>
                    <input class="lista__segunda-linha__input input-reps2" type="number">
                </li>
                <li class="lista__segunda-linha__item">
                    <input class="lista__segunda-linha__input input-kg" type="number">
                </li>
                <li class="lista__segunda-linha__item">
                    <input class="lista__segunda-linha__input input-rpe1" type="number">
                    <p>-</p>
                    <input class="lista__segunda-linha__input input-rpe2" type="number">
                </li>
            </ul>

            <ul class="set-buttons">
                <li class="set-buttons__item">
                    <button id="button1-add-w" class="add-w-button" onclick="myFunctionWSet('exercicio-1', this.id)">Add a-Set</button>
                    <button id="button1-add" class="add-button" onclick="myFunction('exercicio-1', this.id)">Add Set</button>
                    <button id="button1-undo" class="undo-button" onclick="undoFunction('exercicio-1', this.id)">Exc Set</button>
                </li>
            </ul>
            
        </section>

        
        <div class="session-buttons">
            <button class="new-session-button" onclick="addSection()">Adicionar exercício</button>
            <button class="remove-session-button" onclick="removeLastSection()">Remover exercício</button>
        </div>

    </main>
    <footer class="rodape">
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

    <script>
        // Função para exportar o texto para o WhatsApp
        function exportToWhatsApp() {
            // Selecionar os elementos desejados
            let tituloTreino = document.querySelector('.titulo-do-treino').value;
            let obsTreino = document.querySelector('.treino__obs').value;
            let exercicios = document.querySelectorAll('.exercicio-n');
            let textoExercicios = '';
    
            // Iterar sobre cada exercício
            exercicios.forEach((exercicio, index) => {
                let nomeExercicio = exercicio.querySelector('.exercicio__nome').value;
                let obsExercicio = exercicio.querySelector('.exercicio__obs').value;
                let sets = exercicio.querySelectorAll('.lista__segunda-linha__item');
                let aquecimentoInputs = exercicio.querySelectorAll('.lista__aquecimento__input');
                let segundaLinhaInputs = exercicio.querySelectorAll('.lista__segunda-linha__input');
    
                // Adicionar uma quebra de linha entre os exercícios, exceto para o primeiro
                if (index !== 0) {
                    textoExercicios += '\n\n';
                }
    
                // Montar o texto do exercício
                textoExercicios += `Exercício ${index + 1}: ${nomeExercicio}\n`;
                textoExercicios += `Observações: ${obsExercicio}\n\n`;
    
                // Adicionar os valores dos aquecimentos
                textoExercicios += "Aquecimento:\n";
                for (let i = 0; i < aquecimentoInputs.length; i += 3) {
                    textoExercicios += `- ${aquecimentoInputs[i].value}-${aquecimentoInputs[i + 1].value} reps ${aquecimentoInputs[i + 2].value}kg\n`;
                }
    
                // Adicionar os valores da segunda linha
                textoExercicios += "\nSéries efetivas:\n";
                for (let i = 0; i < segundaLinhaInputs.length; i += 5) {
                    textoExercicios += `- ${segundaLinhaInputs[i].value}-${segundaLinhaInputs[i + 1].value} reps ${segundaLinhaInputs[i + 2].value}kg @${segundaLinhaInputs[i + 3].value}-${segundaLinhaInputs[i + 4].value}\n`;
                }
            });
    
            // Montar o texto completo
            let textoCompleto = `Título do Treino: ${tituloTreino}\n`;
            textoCompleto += `Observações Gerais: ${obsTreino}\n\n`;
            textoCompleto += `${textoExercicios}\n`;
    
            // Formatar o texto para o formato de URL do WhatsApp
            let textoWhatsApp = encodeURIComponent(textoCompleto);
    
            // Abrir o WhatsApp com o texto formatado
            window.open(`https://wa.me/?text=${textoWhatsApp}`, '_blank');
        }
    </script>
    

    <script>
        function myFunction(sectionId, buttonId) {
            let i = document.getElementById(sectionId).querySelectorAll(".lista__segunda-linha").length + 1;
            let ul = document.createElement("ul");
            ul.className = "lista__segunda-linha";
            ul.innerHTML = '<li class="lista__segunda-linha__item"><p>' + i + '</p></li><li class="lista__segunda-linha__item"><input class="lista__segunda-linha__input input-reps1" type="number"><p>-</p><input class="lista__segunda-linha__input input-reps2" type="number"></li><li class="lista__segunda-linha__item"><input class="lista__segunda-linha__input input-kg" type="number"></li><li class="lista__segunda-linha__item"><input class="lista__segunda-linha__input input-rpe1" type="number"><p>-</p><input class="lista__segunda-linha__input  input-rpe2" type="number"></li>';
            let setButtons = document.getElementById(sectionId).getElementsByClassName("set-buttons")[0];
            setButtons.parentNode.insertBefore(ul, setButtons);
        }

        function myFunctionWSet(sectionId, buttonId) {
            let ulAquecimento = document.createElement("ul");
            let setId = Math.random().toString(36).substring(7); // Gerar um ID único
            ulAquecimento.className = "lista__aquecimento";
            ulAquecimento.id = "lista__aquecimento_" + setId; // Atribuir um ID único
            ulAquecimento.innerHTML = '<li class="lista__aquecimento__item"><p class="lista__aquecimento__w">a</p></li><li class="lista__aquecimento__item"><input class="lista__aquecimento__input input-reps1" type="number"><p>-</p><input class="lista__aquecimento__input input-reps2" type="number"></li><li class="lista__aquecimento__item"><input class="lista__aquecimento__input input-kg" type="number"></li><li class="lista__aquecimento__item"></li><li class="lista__aquecimento__item"><button class="remove-list-button" onclick="removeList(\'lista__aquecimento_' + setId + '\')"><img class="trash-img" src="img/trash-branca.png"></button></li>';
            let setButtons = document.getElementById(sectionId).getElementsByClassName("set-buttons")[0];
            setButtons.parentNode.insertBefore(ulAquecimento, setButtons);

            // Move a lista__aquecimento para cima da lista__segunda-linha
            let mainSection = document.getElementById(sectionId);
            let segundaLinha = mainSection.querySelector(".lista__segunda-linha");
            mainSection.insertBefore(ulAquecimento, segundaLinha);
        }
        
        function undoFunction(sectionId, buttonId) {
            let myList = document.getElementById(sectionId);
            let lastSet = myList.getElementsByClassName("lista__segunda-linha");
            if (lastSet.length > 1) {
                lastSet[lastSet.length - 1].remove();
            }
        }

        function removeList(listId) {
            let listToRemove = document.getElementById(listId);
            if (listToRemove) {
                listToRemove.parentNode.removeChild(listToRemove);
            }
        }        
    </script>

    <script>
        function addSection() {
            let j = document.querySelectorAll('.exercicio-n').length + 1;
            let mainTag = document.querySelector('main');
            let section = document.createElement("section");
            section.className = "exercicio-n";
            section.id = "exercicio-" + j;
            section.innerHTML = `
            <ul class="lista__nome-do-exercicio">
                    <li class="lista__nome-do-exercicio__item">
                        <p class="lista__nome-do-exercicio__numero">${j}</p>
                        <textarea class="exercicio__nome" placeholder="Nome do exercício" maxlength="32" oninput="limitLines(this, 1)"></textarea>
                        <button class="youtube-button" onclick="searchYouTubeDynamic('exercicio-${j}')">></button>
                    </li>     
                </ul>

                <textarea class="exercicio__obs" placeholder="Observações sobre o exercício" maxlength="150"  oninput="limitLines(this, 4); updateCounter(this)"></textarea>
                <span class="contador"></span>

                <ul class="lista__primeira-linha">
                    <li>
                        <p>Set</p>
                    </li>
                    <li>
                    <select class="select-repetitions">
                        <option class="option" value="reps range">Faixa de Repetições</option>
                        <option value="reps">Repetições</option>
                        <option value="reps max">Repetições Máximas</option>
                        <option value="amrap">AMRAP</option>
                        <option value="time">Tempo</option>
                        <option value="time range">Faixa de Tempo</option>
                    </select>             
                </li>

                <li>
                    <select class="select-kg">
                        <option value="kg">KG</option>
                        <option value="lb">LB</option>
                    </select>             
                </li>

                <li>
                    <select class="select-rpe">
                        <option value="rpe range">Faixa de Int. (PSE)</option>
                        <option value="rpe">Int. (PSE)</option>
                        <option value="% of 1rm range">Faixa de % de 1RM</option>
                        <option value="% of 1rm">% de 1RM</option>
                    </select>             
                </li>

                </ul>


                <ul class="lista__aquecimento">
                    <li class="lista__aquecimento__item">
                        <p class="lista__aquecimento__w">a</p>
                    </li>
                    <li class="lista__aquecimento__item">
                        <input class="lista__aquecimento__input input-reps1" type="number">
                        <p>-</p>
                        <input class="lista__aquecimento__input input-reps2" type="number">
                    </li>
                    <li class="lista__aquecimento__item">
                        <input class="lista__aquecimento__input input-kg" type="number">
                    </li>
                    <li class="lista__aquecimento__item">
                    </li>
                    <li class="lista__aquecimento__item">
                        
                    </li>
                </ul>


                <ul id="myList${j}" class="lista__segunda-linha">
                    <li class="lista__segunda-linha__item">
                        <p>1</p>
                    </li>
                    <li class="lista__segunda-linha__item">
                        <input class="lista__segunda-linha__input input-reps1" type="number">
                        <p>-</p>
                        <input class="lista__segunda-linha__input input-reps2" type="number">
                    </li>
                    <li class="lista__segunda-linha__item">
                        <input class="lista__segunda-linha__input input-kg" type="number">
                    </li>
                    <li class="lista__segunda-linha__item">
                        <input class="lista__segunda-linha__input input-rpe1" type="number">
                        <p>-</p>
                        <input class="lista__segunda-linha__input input-rpe2" type="number">
                    </li>
                </ul>

                <ul class="set-buttons">
                    <li class="set-buttons__item">
                        <button id="button${j}-add-w" class="add-w-button" onclick="myFunctionWSet('exercicio-${j}', this.id)">Add a-Set</button>
                        <button id="button${j}-add" class="add-button" onclick="myFunction('exercicio-${j}', this.id)">Add Set</button>
                        <button id="button${j}-undo" class="undo-button" onclick="undoFunction('exercicio-${j}', this.id)">Exc Set</button>
                    </li>
                </ul>
                
            `;
            
            // Encontrar a div "session-buttons"
            let sessionButtons = document.querySelector('.session-buttons');

            // Inserir a nova sessão antes da div "session-buttons"
            mainTag.insertBefore(section, sessionButtons);
            }

        function removeLastSection() {
            let main = document.querySelector('main');
            let lastSection = main.lastElementChild;
            
            // Verificar se o último elemento filho é um botão ou uma seção
            while (lastSection && !lastSection.id.startsWith('exercicio-')) {
                lastSection = lastSection.previousElementSibling;
            }

            if (lastSection) {
                lastSection.parentNode.removeChild(lastSection);
            }
        }    
    </script>

    <script>
        function exportToExcel() {
            let data = [];

            // Título do Treino
            let tituloTreino = document.querySelector('.titulo-do-treino').value;
            data.push(["Título do Treino", tituloTreino]);

            // Observações Gerais do Treino
            let obsTreino = document.querySelector('.treino__obs').value;
            data.push(["Observações Gerais", obsTreino]);

            // Coleta os dados dos campos de input dos exercícios
            let exercicios = document.querySelectorAll('.exercicio-n');
            exercicios.forEach((exercicio, index) => {
                let nomeExercicio = exercicio.querySelector('.exercicio__nome').value;
                let obsExercicio = exercicio.querySelector('.exercicio__obs').value;
                data.push(["Exercício " + (index + 1) + " - Nome", nomeExercicio]);
                data.push(["Exercício " + (index + 1) + " - Observações", obsExercicio]);

                // Coleta os dados dos campos de input de aquecimento
                let aquecimentoInputs = exercicio.querySelectorAll('.lista__aquecimento__input');
                aquecimentoInputs.forEach(input => {
                    data.push(["Exercício " + (index + 1) + " - Aquecimento", input.value]);
                });

                // Coleta os dados dos campos de input da segunda linha
                let segundaLinhaInputs = exercicio.querySelectorAll('.lista__segunda-linha__input');
                segundaLinhaInputs.forEach(input => {
                    data.push(["Exercício " + (index + 1) + " - Segunda Linha", input.value]);
                });
            });

            // Cria um novo workbook
            let wb = XLSX.utils.book_new();
            let ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, "Dados");

            // Salva o workbook como um arquivo Excel
            XLSX.writeFile(wb, 'dados_excel.xlsx');
        }


    </script>

    <script>
        function saveData() {
            let data = "";

            // Coleta os dados dos campos de input
            let inputs = document.querySelectorAll('.lista__segunda-linha__input');
            inputs.forEach(input => {
                data += input.value + "\n";
            });

            // Salva os dados em um arquivo de log
            download("dados_log.txt", data);
        }

        // Função para realizar o download do arquivo
        function download(filename, text) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
        }

    </script>

    <script>
        function searchYouTubeDynamic(sectionId) {
            // Encontra o elemento de exercício correspondente ao sectionId
            var exerciseElement = document.getElementById(sectionId);
            
            // Encontra o textarea dentro do elemento de exercício para obter o nome do exercício
            var exerciseNameTextarea = exerciseElement.querySelector('.exercicio__nome');
            
            // Obtém o texto do nome do exercício
            var keyword = exerciseNameTextarea.value.trim();

            // Verifica se há uma palavra-chave válida
            if (keyword) {
                // Substitui os espaços por "+" na palavra-chave para formar a URL de busca
                keyword = keyword.replace(/\s/g, '+');

                // URL de busca do YouTube com a palavra-chave inserida e o número máximo de resultados
                var searchUrl = 'https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=1&q=' + keyword + '&key=AIzaSyAak9tSnzEoKqk50Kmz39nFZWAWAV7V4ro';

                // Requisição AJAX para a API do YouTube
                var xhr = new XMLHttpRequest();
                xhr.open('GET', searchUrl, true);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        var response = JSON.parse(xhr.responseText);
                        if (response.items && response.items.length > 0) {
                            // Obtém o ID do vídeo
                            var videoId = response.items[0].id.videoId;
                            
                            // Cria o iframe para o vídeo incorporado
                            var iframe = document.createElement('iframe');
                            iframe.setAttribute('width', '400');
                            iframe.setAttribute('height', '225');
                            iframe.setAttribute('src', 'https://www.youtube.com/embed/' + videoId);
                            iframe.setAttribute('frameborder', '0');
                            iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
                            iframe.setAttribute('allowfullscreen', '');

                            // Encontra o contêiner de vídeo correspondente e o preenche com o iframe
                            var videoContainer = exerciseElement.querySelector('.video-container');
                            videoContainer.innerHTML = ''; // Limpa o conteúdo existente
                            videoContainer.appendChild(iframe);
                        } else {
                            alert('Nenhum vídeo encontrado para a palavra-chave inserida.');
                        }
                    }
                };
                xhr.send();
            } else {
                alert('Por favor, insira o nome do exercício.');
            }
        }

    </script>

    <script>
        // Adiciona eventos para limitar o número de caracteres em cada textarea
        document.addEventListener("DOMContentLoaded", function() {
            var textareas = document.querySelectorAll('textarea');
        
            textareas.forEach(function(textarea) {
                textarea.addEventListener('input', function() {
                    var maxLength = parseInt(this.getAttribute('maxlength'));
                    var currentLength = this.value.length;
        
                    if (currentLength > maxLength) {
                        this.value = this.value.slice(0, maxLength);
                    }
                });
            });
        });
    </script>

    <script>
        // Função para atualizar o contador de caracteres
        function updateCounter(textarea) {
            var maxLength = parseInt(textarea.getAttribute('maxlength'));
            var currentLength = textarea.value.length;
            var contador = textarea.nextElementSibling;

            contador.textContent = currentLength + '/' + maxLength;
        }

        // Função para limitar o número de linhas em uma textarea
        function limitLines(textarea, maxLines) {
            var lines = textarea.value.split('\n');
            if (lines.length > maxLines) {
                textarea.value = lines.slice(0, maxLines).join('\n');
            }
        }
    </script>


</body>
</html>
